<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GravityCraft Support</title>
    <link rel="icon" type="image/png" href="https://lh3.googleusercontent.com/e-EYjsUVBeXvAbrSND3ts6bh3mWQsbf4ceGSy33YRuuMl2O3EYmijyx8uaU1N3InHd_w3ICwzVOnlbCdPO2fQV71yVwrKrfLYccmESsAZI_U9YkX9lqMBwXVnjSs3DlVipmCMB1h3Z8=w16383">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --main-bg-color: #0a0a0a;
            --secondary-bg-color: #1a1a1a;
            --accent-color: #ff2a2a;
            --accent-hover: #ff4d4d;
            --text-color: #f0f0f0;
            --text-secondary: #b0b0b0;
            --success-color: #4CAF50;
            --warning-color: #FF9800;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--main-bg-color);
            color: var(--text-color);
            min-height: 100vh;
            background-image: linear-gradient(rgba(10, 10, 10, 0.85), rgba(10, 10, 10, 0.85)), 
                              url('https://newcdn.igromania.ru/mnt/articles/9/3/c/8/9/a/32337/html/more/_e1a46e755fc52b86675af1c_1920xH.webp');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            display: flex;
            flex-direction: column;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }
        
        /* Экран входа */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-image: linear-gradient(rgba(10, 10, 10, 0.85), rgba(10, 10, 10, 0.85)), 
                              url('https://newcdn.igromania.ru/mnt/articles/9/3/c/8/9/a/32337/html/more/_e1a46e755fc52b86675af1c_1920xH.webp');
            background-size: cover;
            background-position: center;
        }
        
        .login-box {
            background-color: var(--secondary-bg-color);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(255, 42, 42, 0.3);
            width: 350px;
            text-align: center;
            border: 1px solid var(--accent-color);
            animation: pulse 2s infinite alternate;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 20px rgba(255, 42, 42, 0.3);
            }
            100% {
                box-shadow: 0 0 30px rgba(255, 42, 42, 0.6);
            }
        }
        
        .login-box h2 {
            color: var(--accent-color);
            margin-bottom: 25px;
            font-size: 24px;
            text-transform: uppercase;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .login-box input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #333;
            border-radius: 8px;
            background-color: #222;
            color: var(--text-color);
            font-size: 16px;
            box-sizing: border-box;
        }
        
        .login-box input:focus {
            outline: none;
            border-color: var(--accent-color);
        }
        
        .login-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .login-btn:hover {
            background-color: var(--accent-hover);
            transform: translateY(-2px);
        }
        
        .login-error {
            color: var(--accent-color);
            margin-top: 10px;
            display: none;
        }
        
        /* Шапка */
        .header {
            background-color: rgba(26, 26, 26, 0.9);
            padding: 15px 0;
            border-bottom: 2px solid var(--accent-color);
            margin-bottom: 20px;
            border-radius: 0 0 15px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }
        
        .header.collapsed {
            transform: translateY(-100%);
        }
        
        .header-toggle {
            position: fixed;
            top: 50%; /* Располагаем по центру вертикально */
            right: 10px;
            transform: translateY(-50%); /* Центрируем точно по середине */
            background-color: rgba(255, 42, 42, 0.7); /* Прозрачность 70% */
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 101;
            transition: all 0.3s;
            opacity: 0.7; /* Добавляем общую прозрачность */
            display: none; /* По умолчанию скрыта */
        }

        .header-toggle:hover {
            background-color: rgba(255, 42, 42, 0.9); /* При наведении делаем менее прозрачной */
            transform: translateY(-50%) scale(1.1);
            opacity: 1;
        }
        
        .header h1 {
            color: var(--accent-color);
            margin: 0;
            font-size: 28px;
            text-transform: uppercase;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            font-size: 32px;
            color: var(--accent-color);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-details {
            text-align: right;
        }
        
        .logged-as {
            color: var(--text-color);
            font-size: 14px;
        }
        
        .username {
            color: var(--accent-color);
            font-weight: bold;
        }
        
        .user-role {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .logout-btn {
            background-color: transparent;
            color: var(--accent-color);
            border: 1px solid var(--accent-color);
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .logout-btn:hover {
            background-color: var(--accent-color);
            color: white;
        }
        
        /* Навигационные вкладки */
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 30px;
            background: rgba(30, 30, 30, 0.7);
            padding: 10px;
            border-radius: 10px;
        }
        
        .tab {
            flex: 1;
            text-align: center;
            padding: 12px 0;
            background-color: rgba(40, 40, 40, 0.5);
            border: none;
            color: var(--text-secondary);
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .tab:hover {
            background-color: rgba(255, 42, 42, 0.1);
            color: var(--text-color);
        }
        
        .tab.active {
            background-color: var(--accent-color);
            color: white;
            box-shadow: 0 0 10px rgba(255, 42, 42, 0.5);
        }
        
        /* Основные секции */
        .section {
            background-color: rgba(26, 26, 26, 0.8);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid var(--accent-color);
            margin-bottom: 30px;
            display: none;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 42, 42, 0.3);
        }
        
        .section-title {
            color: var(--accent-color);
            margin: 0;
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            font-size: 20px;
        }
        
        .action-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .action-btn:hover {
            background-color: var(--accent-hover);
            transform: translateY(-2px);
        }
        
        /* Таблица актива (компактная) */
        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            border: 1px solid rgba(255, 42, 42, 0.3);
            background-color: rgba(40, 40, 40, 0.5);
            box-shadow: 0 0 15px rgba(255, 42, 42, 0.1);
            max-height: 500px;
            position: relative;
        }
        
        /* Кастомный скроллбар */
        .table-container::-webkit-scrollbar {
            height: 12px;
        }
        
        .table-container::-webkit-scrollbar-track {
            background: transparent;
            border-radius: 10px;
        }
        
        .table-container::-webkit-scrollbar-thumb {
            background: rgba(255, 42, 42, 0.5);
            border-radius: 10px;
            border: 2px solid rgba(40, 40, 40, 0.5);
        }
        
        .table-container::-webkit-scrollbar-thumb:hover {
            background: var(--accent-color);
        }
        
        .activation-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        .activation-table th, .activation-table td {
            padding: 10px 12px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            min-width: 30px;
            font-size: 14px;
        }
        
        .activation-table th {
            background-color: rgba(255, 42, 42, 0.2);
            color: var(--accent-color);
            font-weight: bold;
            text-transform: uppercase;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .activation-table th:first-child,
        .activation-table th:nth-child(2) {
            position: sticky;
            left: 0;
            z-index: 20;
            min-width: 120px;
        }
        
        .activation-table td:first-child,
        .activation-table td:nth-child(2) {
            position: sticky;
            left: 0;
            z-index: 10;
            background-color: rgba(26, 26, 26, 0.9);
        }
        
        .activation-table th:last-child,
        .activation-table td:last-child {
            position: sticky;
            right: 0;
            z-index: 10;
            background-color: rgba(26, 26, 26, 0.9);
            min-width: 80px;
        }
        
        .activation-table th:last-child {
            background-color: rgba(255, 42, 42, 0.2);
            z-index: 20;
        }
        
        .activation-table tr:last-child td {
            border-bottom: none;
        }
        
        .activation-table tr:nth-child(even) {
            background-color: rgba(50, 50, 50, 0.3);
        }
        
        .activation-table tr:hover {
            background-color: rgba(255, 42, 42, 0.1);
        }
        
        /* Стили для должностей */
        .admin-row {
            background-color: rgba(255, 42, 42, 0.4) !important;
            font-weight: bold;
        }
        
        .support-lead-row {
            background-color: rgba(255, 42, 42, 0.3) !important;
            font-weight: bold;
        }
        
        .leads-helper-row {
            background-color: rgba(255, 42, 42, 0.25) !important;
        }
        
        .support-row {
            background-color: rgba(255, 42, 42, 0.15) !important;
        }
        
        .support-assistant-row {
            opacity: 0.8;
        }
        
        .day-cell {
            position: relative;
        }
        
        .day-cell input {
            width: 30px;
            height: 30px;
            background: rgba(30, 30, 30, 0.7);
            border: 1px solid #444;
            color: white;
            text-align: center;
            font-size: 14px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .day-cell input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 5px rgba(255, 42, 42, 0.5);
            background: rgba(255, 42, 42, 0.2);
        }
        
        .readonly-input {
            background-color: #333 !important;
            color: #888 !important;
            cursor: not-allowed;
        }
        
        .delete-member {
            color: var(--accent-color);
            cursor: pointer;
            font-weight: bold;
            margin-left: 10px;
            transition: all 0.2s;
            background: none;
            border: none;
            font-size: 16px;
        }
        
        .delete-member:hover {
            color: white;
            text-shadow: 0 0 5px var(--accent-color);
        }
        
        /* Методичка */
        .manual-categories {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .category-card {
            background-color: rgba(40, 40, 40, 0.5);
            border-radius: 10px;
            border: 1px solid rgba(255, 42, 42, 0.3);
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(255, 42, 42, 0.2);
        }
        
        .category-header {
            background-color: rgba(255, 42, 42, 0.2);
            padding: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .category-header h3 {
            margin: 0;
            color: var(--accent-color);
        }
        
        .category-actions {
            display: flex;
            gap: 10px;
        }
        
        .category-content {
            padding: 15px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .category-card.active .category-content {
            max-height: 1000px;
        }
        
        .post {
            background-color: rgba(0, 0, 0, 0.3);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            border-left: 3px solid var(--accent-color);
            position: relative;
            width: 100%;
        }
        
        .post:last-child {
            margin-bottom: 0;
        }
        
        .post-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .post-title {
            font-weight: bold;
            color: var(--accent-color);
            max-width: 70%;
            font-size: 18px;
        }
        
        .post-date {
            color: var(--text-secondary);
            font-size: 0.9em;
        }
        
        .post-content {
            line-height: 1.6;
            font-size: 16px;
            padding: 10px;
        }
        
        .post-actions {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 8px;
        }
        
        .post-btn {
            background: rgba(255, 42, 42, 0.3);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .post-btn:hover {
            background: var(--accent-color);
        }
        
        /* Админ панель */
        .admin-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-top: 20px;
        }
        
        .admin-card {
            background-color: rgba(40, 40, 40, 0.5);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid rgba(255, 42, 42, 0.3);
        }
        
        .admin-card h3 {
            color: var(--accent-color);
            margin-top: 0;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 42, 42, 0.3);
        }
        
        .user-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .user-form input, .user-form select {
            padding: 12px;
            background-color: #222;
            border: 1px solid #333;
            color: var(--text-color);
            border-radius: 8px;
            font-size: 15px;
        }
        
        .user-form input:focus, .user-form select:focus {
            outline: none;
            border-color: var(--accent-color);
        }
        
        .users-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .user-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .user-item:last-child {
            border-bottom: none;
        }
        
        .delete-user {
            color: var(--accent-color);
            cursor: pointer;
            background: none;
            border: none;
            font-size: 16px;
        }
        
        /* Редактор методички */
        .editor-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .editor-content {
            background: var(--secondary-bg-color);
            width: 90%;
            max-width: 900px;
            height: 80vh;
            border-radius: 15px;
            border: 2px solid var(--accent-color);
            box-shadow: 0 0 30px rgba(255, 42, 42, 0.5);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .editor-header {
            padding: 15px 20px;
            background: rgba(255, 42, 42, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .editor-toolbar {
            padding: 10px 15px;
            background: rgba(40, 40, 40, 0.8);
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            border-bottom: 1px solid #444;
        }
        
        .tool-btn {
            background: rgba(60, 60, 60, 0.8);
            border: 1px solid #555;
            color: var(--text-color);
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }
        
        .tool-btn:hover {
            background: rgba(255, 42, 42, 0.3);
            border-color: var(--accent-color);
        }
        
        .editor-body {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .editor-title {
            width: 100%;
            padding: 12px;
            background: #222;
            border: 1px solid #444;
            color: white;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 18px;
        }
        
        .editor-main {
            width: 100%;
            min-height: 400px;
            padding: 15px;
            background: #222;
            border: 1px solid #444;
            color: white;
            border-radius: 8px;
            font-size: 16px;
            line-height: 1.5;
        }
        
        .editor-main:focus {
            outline: none;
            border-color: var(--accent-color);
        }
        
        .editor-footer {
            padding: 15px 20px;
            background: rgba(40, 40, 40, 0.8);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .editor-footer button {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        
        .save-btn {
            background: var(--success-color);
            color: white;
        }
        
        .cancel-btn {
            background: var(--accent-color);
            color: white;
        }
        
        .editor-footer button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        /* Уведомления */
        .notification {
            position: fixed;
            bottom: 20px;
            left: 20px;
            padding: 15px 25px;
            background-color: rgba(26, 26, 26, 0.95);
            border: 1px solid var(--accent-color);
            border-radius: 8px;
            color: var(--text-color);
            box-shadow: 0 0 15px rgba(255, 42, 42, 0.5);
            z-index: 2000;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(-150%);
            transition: transform 0.3s ease-in-out;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            border-color: var(--success-color);
        }
        
        .notification.error {
            border-color: var(--accent-color);
        }
        
        .notification-icon {
            font-size: 24px;
        }
        
        .notification.success .notification-icon {
            color: var(--success-color);
        }
        
        .notification.error .notification-icon {
            color: var(--accent-color);
        }
        
        /* Синхронизация */
        .sync-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 15px;
            background-color: rgba(26, 26, 26, 0.9);
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
        
        .sync-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--success-color);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }
        
        /* Модальное окно добавления участника */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: var(--secondary-bg-color);
            padding: 30px;
            border-radius: 15px;
            width: 400px;
            max-width: 90%;
            border: 2px solid var(--accent-color);
            box-shadow: 0 0 30px rgba(255, 42, 42, 0.5);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-header h3 {
            color: var(--accent-color);
            margin: 0;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
        }
        
        .modal-body {
            margin-bottom: 20px;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .modal-btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        
        .modal-btn-primary {
            background: var(--accent-color);
            color: white;
        }
        
        .modal-btn-secondary {
            background: #444;
            color: white;
        }
        
        /* Адаптивность */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1 0 45%;
                font-size: 14px;
                padding: 10px;
            }
            
            .section {
                padding: 15px;
            }
            
            .admin-grid {
                grid-template-columns: 1fr;
            }
            
            .table-container {
                font-size: 12px;
            }
            
            .activation-table th, 
            .activation-table td {
                padding: 8px 10px;
            }
            
            .day-cell input {
                width: 25px;
                height: 25px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Уведомления -->
    <div class="notification" id="notification">
        <span class="notification-icon">✓</span>
        <span id="notification-message">Данные сохранены успешно!</span>
    </div>
    
    <!-- Синхронизация -->
    <div class="sync-status">
        <span class="sync-indicator"></span>
        <span>Синхронизация данных...</span>
    </div>
    
    <!-- Кнопка для скрытия/показа шапки -->
    <button class="header-toggle" id="headerToggle" style="display: none;">
        <i class="fas fa-bars"></i>
    </button>
    
    <!-- Модальное окно добавления участника -->
    <div class="modal" id="addMemberModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Добавить участника</h3>
                <button class="close-modal" id="closeAddMemberModal">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">Пользователь</label>
                    <select id="memberUser" style="width: 100%; padding: 10px; background: #222; border: 1px solid #444; color: white; border-radius: 8px;">
                        <option value="">Выберите пользователя</option>
                    </select>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">Должность</label>
                    <select id="memberPosition" style="width: 100%; padding: 10px; background: #222; border: 1px solid #444; color: white; border-radius: 8px;">
                        <option value="admin">Администратор</option>
                        <option value="support-lead">Support Lead</option>
                        <option value="leads-helper">Lead's Helper</option>
                        <option value="support">Support</option>
                        <option value="support-assistant">Support Assistant</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="cancelAddMember">Отмена</button>
                <button class="modal-btn modal-btn-primary" id="confirmAddMember">Добавить</button>
            </div>
        </div>
    </div>
    
    <!-- Редактор методички -->
    <div class="editor-modal" id="editorModal">
        <div class="editor-content">
            <div class="editor-header">
                <h3>Редактор методички</h3>
                <button class="close-editor">&times;</button>
            </div>
            <div class="editor-toolbar">
                <button class="tool-btn" data-command="bold"><i class="fas fa-bold"></i></button>
                <button class="tool-btn" data-command="italic"><i class="fas fa-italic"></i></button>
                <button class="tool-btn" data-command="underline"><i class="fas fa-underline"></i></button>
                <button class="tool-btn" data-command="insertImage"><i class="fas fa-image"></i> Изображение</button>
                <button class="tool-btn" data-command="insertGif"><i class="fas fa-film"></i> GIF</button>
                <button class="tool-btn" data-command="insertLink"><i class="fas fa-link"></i> Ссылка</button>
                <button class="tool-btn" data-command="insertTable"><i class="fas fa-table"></i> Таблица</button>
                <button class="tool-btn" data-command="insertList"><i class="fas fa-list"></i> Список</button>
                <select class="tool-btn" id="fontSize" style="width: auto;">
                    <option value="1">Маленький</option>
                    <option value="3" selected>Нормальный</option>
                    <option value="5">Большой</option>
                    <option value="7">Очень большой</option>
                </select>
                <input type="color" class="tool-btn" id="textColor" style="width: 40px; height: 30px; padding: 0;">
            </div>
            <div class="editor-body">
                <input type="text" class="editor-title" id="editorTitle" placeholder="Название материала">
                <div class="editor-main" id="editorContent" contenteditable="true"></div>
            </div>
            <div class="editor-footer">
                <button class="cancel-btn">Отмена</button>
                <button class="save-btn">Сохранить</button>
            </div>
        </div>
    </div>
    
    <!-- Экран входа -->
    <div class="login-container" id="loginPage">
        <div class="login-box">
            <h2><i class="fas fa-cubes"></i> GravityCraft SUPPORT</h2>
            <input type="text" id="username" placeholder="Логин" value="vitya1228">
            <input type="password" id="password" placeholder="Пароль" value="vitya4455">
            <button class="login-btn" id="loginBtn">Войти</button>
            <div class="login-error" id="loginError">Неверный логин или пароль</div>
        </div>
    </div>
    
    <!-- Основной интерфейс -->
    <div id="mainInterface" style="display: none;">
        <!-- Шапка -->
        <div class="header" id="mainHeader">
            <div class="logo">
                <i class="fas fa-cubes logo-icon"></i>
                <h1>GravityCraft Support</h1>
            </div>
            <div class="user-info">
                <div class="user-details">
                    <div class="logged-as">Вы вошли как: <span class="username" id="currentUsername">Администратор</span></div>
                    <div class="user-role" id="currentRole">Администратор</div>
                </div>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    Выйти
                </button>
            </div>
        </div>
        
        <div class="container">
            <!-- Навигационные вкладки -->
            <div class="tabs">
                <button class="tab active" data-section="activation">
                    <i class="fas fa-table"></i>
                    Таблица актива
                </button>
                <button class="tab" data-section="manual">
                    <i class="fas fa-book"></i>
                    Методичка
                </button>
                <button class="tab" data-section="admin" id="adminTab">
                    <i class="fas fa-user-cog"></i>
                    Админ-панель
                </button>
            </div>
            
            <!-- Таблица актива -->
            <div class="section active" id="activationSection">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-users"></i>
                        Таблица актива сотрудников (Июнь 2025)
                    </h2>
                    <button class="action-btn" id="addMemberBtn">
                        <i class="fas fa-plus"></i>
                        Добавить участника
                    </button>
                </div>
                <div class="table-container">
                    <table class="activation-table" id="activationTable">
                        <thead>
                            <tr>
                                <th>Участник</th>
                                <th>Должность</th>
                                <!-- Дни будут добавлены через JS -->
                                <th>Итого</th>
                            </tr>
                        </thead>
                        <tbody id="activationTableBody">
                            <!-- Данные будут добавлены через JS -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Методичка -->
            <div class="section" id="manualSection">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-graduation-cap"></i>
                        Методичка для сотрудников
                    </h2>
                    <button class="action-btn" id="addCategoryBtn">
                        <i class="fas fa-plus"></i>
                        Добавить категорию
                    </button>
                </div>
                
                <div class="manual-categories" id="manualCategories">
                    <!-- Категории будут добавляться динамически -->
                </div>
            </div>
            
            <!-- Админ-панель -->
            <div class="section" id="adminSection">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-cog"></i>
                        Администрирование системы
                    </h2>
                </div>
                
                <div class="admin-grid">
                    <div class="admin-card">
                        <h3><i class="fas fa-user-plus"></i> Добавить пользователя</h3>
                        <div class="user-form">
                            <input type="text" placeholder="Логин пользователя" id="newUsername">
                            <input type="password" placeholder="Пароль" id="newPassword">
                            <select id="newUserRole">
                                <option value="admin">Администратор</option>
                                <option value="support-lead">Support Lead</option>
                                <option value="leads-helper">Lead's Helper</option>
                                <option value="support">Support</option>
                                <option value="support-assistant">Support Assistant</option>
                            </select>
                            <button class="action-btn" id="addUserBtn">Добавить пользователя</button>
                        </div>
                    </div>
                    
                    <div class="admin-card">
                        <h3><i class="fas fa-users"></i> Список пользователей</h3>
                        <div class="users-list" id="usersList">
                            <!-- Пользователи будут добавляться динамически -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Данные приложения
        const appData = {
            activationData: [
                { name: "Vitya", position: "admin", days: Array(30).fill("0") }
            ],
            
            manualData: {
                categories: [
                    {
                        id: 1,
                        name: "Основная информация",
                        posts: [
                            {
                                id: 1,
                                title: "Добро пожаловать в GravityCraft Support",
                                content: "<p>Добро пожаловать в методичку GravityCraft Support. Здесь вы найдете всю необходимую информацию для работы.</p><p>Основные задачи отдела поддержки:</p><ul><li>Помощь игрокам по техническим вопросам</li><li>Модерация игрового процесса</li><li>Решение проблем с балансом игры</li><li>Поддержка администрации проекта</li></ul>",
                                date: "14.06.2025"
                            },
                            {
                                id: 2,
                                title: "Стандарты работы",
                                content: "<p>Все сотрудники должны соблюдать следующие стандарты работы:</p><ol><li>Вежливое общение с игроками</li><li>Оперативное решение проблем</li><li>Следование установленным процедурам</li><li>Своевременное обновление статусов задач</li></ol>",
                                date: "12.06.2025"
                            }
                        ]
                    },
                    {
                        id: 2,
                        name: "Техническая поддержка",
                        posts: [
                            {
                                id: 3,
                                title: "Решение проблем с запуском игры",
                                content: "<p>Если игрок не может запустить игру, выполните следующие шаги:</p><ol><li>Проверьте системные требования</li><li>Обновите драйвера видеокарты</li><li>Переустановите DirectX и Visual C++ Redistributable</li><li>Добавьте исключение в антивирус</li></ol>",
                                date: "10.06.2025"
                            }
                        ]
                    }
                ]
            },
            
            users: [
                { username: "vitya1228", password: "vitya4455", role: "admin" },
                { username: "support1", password: "support1", role: "support" },
                { username: "assistant1", password: "assistant1", role: "support-assistant" }
            ],
            
            currentUser: null
        };
        
        // Порядок сортировки должностей
        const positionOrder = {
            'admin': 1,
            'support-lead': 2,
            'leads-helper': 3,
            'support': 4,
            'support-assistant': 5
        };
        
        // Инициализация приложения
        document.addEventListener('DOMContentLoaded', function() {
            // Элементы интерфейса
            const loginPage = document.getElementById('loginPage');
            const mainInterface = document.getElementById('mainInterface');
            const loginBtn = document.getElementById('loginBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const loginError = document.getElementById('loginError');
            const tabs = document.querySelectorAll('.tab');
            const sections = document.querySelectorAll('.section');
            const notification = document.getElementById('notification');
            const notificationMessage = document.getElementById('notification-message');
            const editorModal = document.getElementById('editorModal');
            const addMemberModal = document.getElementById('addMemberModal');
            const closeAddMemberModal = document.getElementById('closeAddMemberModal');
            const cancelAddMember = document.getElementById('cancelAddMember');
            const adminTab = document.getElementById('adminTab');
            const headerToggle = document.getElementById('headerToggle');
            const mainHeader = document.getElementById('mainHeader');
            
            // Проверка авторизации при загрузке
            checkAuth();
            
            // Обработчик входа
            loginBtn.addEventListener('click', function() {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                const user = appData.users.find(u => u.username === username && u.password === password);
                
                if (user) {
                    // Успешный вход
                    appData.currentUser = {
                        username: user.username,
                        role: user.role
                    };
                    
                    // Сохраняем в localStorage
                    localStorage.setItem('gravitycraftUser', JSON.stringify(appData.currentUser));
                    
                    // Показываем основной интерфейс
                    showMainInterface();
                    initActivationTable();
                    initManualContent();
                    initUsersList();
                    updateUIForRole();
                    
                    // Скрываем ошибку
                    loginError.style.display = 'none';
                } else {
                    // Неверные данные
                    loginError.style.display = 'block';
                }
            });
            
            // Обработчик выхода
            logoutBtn.addEventListener('click', function() {
                // Удаляем данные пользователя
                localStorage.removeItem('gravitycraftUser');
                appData.currentUser = null;
                
                // Показываем экран входа
                mainInterface.style.display = 'none';
                loginPage.style.display = 'flex';
                headerToggle.style.display = 'none';
            });
            
            // Переключение шапки
            headerToggle.addEventListener('click', function() {
                mainHeader.classList.toggle('collapsed');
            });
            
            // Проверка авторизации
            function checkAuth() {
                const savedUser = localStorage.getItem('gravitycraftUser');
                if (savedUser) {
                    appData.currentUser = JSON.parse(savedUser);
                    showMainInterface();
                    initActivationTable();
                    initManualContent();
                    initUsersList();
                    updateUIForRole();
                    headerToggle.style.display = 'flex';
                } else {
                    loginPage.style.display = 'flex';
                    headerToggle.style.display = 'none';
                }
            }
            
            // Обновление интерфейса в зависимости от роли
            function updateUIForRole() {
                if (!appData.currentUser) return;
                
                const isAdmin = appData.currentUser.role === 'admin';
                const isSupportLead = appData.currentUser.role === 'support-lead';
                const isSupport = appData.currentUser.role === 'support';
                const isSupportAssistant = appData.currentUser.role === 'support-assistant';
                
                // Показываем/скрываем админ-панель
                if (isAdmin || isSupportLead) {
                    adminTab.style.display = 'flex';
                } else {
                    adminTab.style.display = 'none';
                    
                    // Если текущая вкладка - админ-панель, переключаем на таблицу актива
                    if (document.querySelector('.tab.active').dataset.section === 'admin') {
                        document.querySelector('.tab[data-section="activation"]').click();
                    }
                }
                
                // Скрываем кнопки добавления для support и support-assistant
                if (isSupport || isSupportAssistant) {
                    document.getElementById('addMemberBtn').style.display = 'none';
                    document.getElementById('addCategoryBtn').style.display = 'none';
                    
                    // Блокируем редактирование таблицы
                    document.querySelectorAll('.day-cell input').forEach(input => {
                        input.readOnly = true;
                        input.classList.add('readonly-input');
                    });
                } else {
                    document.getElementById('addMemberBtn').style.display = 'flex';
                    document.getElementById('addCategoryBtn').style.display = 'flex';
                }
            }
            
            // Показать основной интерфейс
            function showMainInterface() {
                loginPage.style.display = 'none';
                mainInterface.style.display = 'block';
                headerToggle.style.display = 'flex';
                
                // Обновляем информацию о пользователе
                document.getElementById('currentUsername').textContent = appData.currentUser.username;
                document.getElementById('currentRole').textContent = getRoleName(appData.currentUser.role);
            }
            
            // Переключение вкладок
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const sectionId = this.dataset.section;
                    
                    // Снимаем активный класс со всех вкладок и секций
                    tabs.forEach(t => t.classList.remove('active'));
                    sections.forEach(s => s.classList.remove('active'));
                    
                    // Добавляем активный класс текущей вкладке и секции
                    this.classList.add('active');
                    document.getElementById(`${sectionId}Section`).classList.add('active');
                });
            });
            
            // Показать уведомление
            function showNotification(message, isError = false) {
                notificationMessage.textContent = message;
                notification.className = isError ? 'notification error' : 'notification success';
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
            
            // Инициализация таблицы активации
            function initActivationTable() {
                const table = document.getElementById('activationTable');
                const tbody = document.getElementById('activationTableBody');
                
                // Очищаем таблицу
                tbody.innerHTML = '';
                
                // Добавляем дни в заголовок (30 дней для июня)
                const headerRow = table.querySelector('thead tr');
                
                // Удаляем все дни кроме первых двух и последнего столбца
                while (headerRow.children.length > 3) {
                    headerRow.removeChild(headerRow.children[2]);
                }
                
                // Добавляем дни (1-30)
                for (let i = 1; i <= 30; i++) {
                    const th = document.createElement('th');
                    th.textContent = i;
                    headerRow.insertBefore(th, headerRow.lastElementChild);
                }
                
                // Сортируем данные по должности
                const sortedData = [...appData.activationData].sort((a, b) => {
                    return positionOrder[a.position] - positionOrder[b.position];
                });
                
                // Добавляем строки с данными
                sortedData.forEach((member, index) => {
                    const row = document.createElement('tr');
                    
                    // Добавляем класс в зависимости от должности
                    switch(member.position) {
                        case 'admin': row.className = 'admin-row'; break;
                        case 'support-lead': row.className = 'support-lead-row'; break;
                        case 'leads-helper': row.className = 'leads-helper-row'; break;
                        case 'support': row.className = 'support-row'; break;
                        case 'support-assistant': row.className = 'support-assistant-row'; break;
                    }
                    
                    // Имя участника
                    const nameCell = document.createElement('td');
                    let deleteButton = '';
                    
                    // Добавляем кнопку удаления только для админов и лидов
                    if (appData.currentUser.role === 'admin' || 
                        appData.currentUser.role === 'support-lead') {
                        deleteButton = `<button class="delete-member" data-index="${index}"><i class="fas fa-trash"></i></button>`;
                    }
                    
                    nameCell.innerHTML = `${member.name} ${deleteButton}`;
                    row.appendChild(nameCell);
                    
                    // Должность
                    const positionCell = document.createElement('td');
                    positionCell.textContent = getRoleName(member.position);
                    row.appendChild(positionCell);
                    
                    // Дни месяца
                    let total = 0;
                    member.days.forEach((day, dayIndex) => {
                        const dayCell = document.createElement('td');
                        dayCell.className = 'day-cell';
                        
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.value = day;
                        input.maxLength = 2;
                        input.dataset.member = index;
                        input.dataset.day = dayIndex;
                        
                        // Блокируем ввод для support и support-assistant
                        if (appData.currentUser.role === 'support' || 
                            appData.currentUser.role === 'support-assistant') {
                            input.readOnly = true;
                            input.classList.add('readonly-input');
                        }
                        
                        // Разрешаем ввод только цифр
                        input.addEventListener('input', function() {
                            this.value = this.value.replace(/[^0-9]/g, '');
                            
                            // Обновляем данные
                            const memberIndex = parseInt(this.dataset.member);
                            const dayIndex = parseInt(this.dataset.day);
                            appData.activationData[memberIndex].days[dayIndex] = this.value || '0';
                            
                            // Пересчитываем итого
                            updateTotalForRow(memberIndex);
                        });
                        
                        dayCell.appendChild(input);
                        row.appendChild(dayCell);
                        
                        // Считаем сумму
                        if (day && !isNaN(parseInt(day))) {
                            total += parseInt(day);
                        }
                    });
                    
                    // Столбец "Итого"
                    const totalCell = document.createElement('td');
                    totalCell.className = 'total-cell';
                    totalCell.textContent = total;
                    totalCell.dataset.index = index;
                    row.appendChild(totalCell);
                    
                    tbody.appendChild(row);
                });
                
                // Добавляем обработчики удаления
                document.querySelectorAll('.delete-member').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        if (confirm(`Удалить участника ${appData.activationData[index].name}?`)) {
                            appData.activationData.splice(index, 1);
                            initActivationTable();
                            saveData();
                        }
                    });
                });
            }
            
            // Обновить итоговую сумму для строки
            function updateTotalForRow(memberIndex) {
                const member = appData.activationData[memberIndex];
                let total = 0;
                
                member.days.forEach(day => {
                    if (day && !isNaN(parseInt(day))) {
                        total += parseInt(day);
                    }
                });
                
                // Обновляем ячейку "Итого"
                const totalCell = document.querySelector(`.total-cell[data-index="${memberIndex}"]`);
                if (totalCell) {
                    totalCell.textContent = total;
                }
            }
            
            // Инициализация методички
            function initManualContent() {
                const container = document.getElementById('manualCategories');
                container.innerHTML = '';
                
                appData.manualData.categories.forEach(category => {
                    const categoryCard = document.createElement('div');
                    categoryCard.className = 'category-card';
                    categoryCard.dataset.id = category.id;
                    
                    // Заголовок категории
                    const categoryHeader = document.createElement('div');
                    categoryHeader.className = 'category-header';
                    categoryHeader.innerHTML = `
                        <h3>${category.name}</h3>
                        <div class="category-actions">
                            ${(appData.currentUser.role === 'admin' || 
                              appData.currentUser.role === 'support-lead') ? 
                                `<button class="post-btn add-post-btn" data-category="${category.id}">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <button class="post-btn delete-category-btn" data-category="${category.id}">
                                    <i class="fas fa-trash"></i>
                                </button>` : ''
                            }
                        </div>
                    `;
                    
                    // Контент категории
                    const categoryContent = document.createElement('div');
                    categoryContent.className = 'category-content';
                    
                    // Добавляем посты
                    category.posts.forEach(post => {
                        const postElement = document.createElement('div');
                        postElement.className = 'post';
                        postElement.innerHTML = `
                            ${(appData.currentUser.role === 'admin' || 
                              appData.currentUser.role === 'support-lead') ? 
                                `<div class="post-actions">
                                    <button class="post-btn edit-post-btn" data-category="${category.id}" data-post="${post.id}">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="post-btn delete-post-btn" data-category="${category.id}" data-post="${post.id}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>` : ''
                            }
                            <div class="post-header">
                                <div class="post-title">${post.title}</div>
                                <div class="post-date">${post.date}</div>
                            </div>
                            <div class="post-content">${post.content}</div>
                        `;
                        categoryContent.appendChild(postElement);
                    });
                    
                    // Если постов нет
                    if (category.posts.length === 0) {
                        categoryContent.innerHTML = '<p style="padding: 20px; text-align: center; color: var(--text-secondary);">В этой категории пока нет материалов.</p>';
                    }
                    
                    // Собираем категорию
                    categoryCard.appendChild(categoryHeader);
                    categoryCard.appendChild(categoryContent);
                    container.appendChild(categoryCard);
                    
                    // Обработчик открытия/закрытия категории
                    categoryHeader.querySelector('h3').addEventListener('click', function() {
                        categoryCard.classList.toggle('active');
                    });
                });
                
                // Добавляем обработчики для кнопок
                document.querySelectorAll('.add-post-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const categoryId = parseInt(this.dataset.category);
                        openEditor(null, categoryId);
                    });
                });
                
                document.querySelectorAll('.edit-post-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const categoryId = parseInt(this.dataset.category);
                        const postId = parseInt(this.dataset.post);
                        openEditor(postId, categoryId);
                    });
                });
                
                document.querySelectorAll('.delete-post-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const categoryId = parseInt(this.dataset.category);
                        const postId = parseInt(this.dataset.post);
                        
                        if (confirm('Удалить этот материал?')) {
                            const category = appData.manualData.categories.find(c => c.id === categoryId);
                            if (category) {
                                category.posts = category.posts.filter(p => p.id !== postId);
                                initManualContent();
                                saveData();
                            }
                        }
                    });
                });
                
                document.querySelectorAll('.delete-category-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const categoryId = parseInt(this.dataset.category);
                        
                        if (confirm('Удалить эту категорию и все материалы в ней?')) {
                            appData.manualData.categories = appData.manualData.categories.filter(c => c.id !== categoryId);
                            initManualContent();
                            saveData();
                        }
                    });
                });
            }
            
            // Инициализация списка пользователей
            function initUsersList() {
                const container = document.getElementById('usersList');
                container.innerHTML = '';
                
                appData.users.forEach(user => {
                    if (user.username === appData.currentUser.username) return;
                    
                    const userItem = document.createElement('div');
                    userItem.className = 'user-item';
                    userItem.innerHTML = `
                        <div>
                            <div>${user.username}</div>
                            <div style="font-size: 0.85em; color: var(--text-secondary);">${getRoleName(user.role)}</div>
                        </div>
                        ${appData.currentUser.role === 'admin' ? 
                            `<button class="delete-user" data-username="${user.username}">
                                <i class="fas fa-trash"></i>
                            </button>` : ''
                        }
                    `;
                    container.appendChild(userItem);
                });
                
                // Обработчики удаления пользователей
                document.querySelectorAll('.delete-user').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const username = this.dataset.username;
                        if (confirm(`Удалить пользователя ${username}?`)) {
                            appData.users = appData.users.filter(u => u.username !== username);
                            initUsersList();
                            saveData();
                        }
                    });
                });
            }
            
            // Функция для получения читаемого названия роли
            function getRoleName(role) {
                switch(role) {
                    case 'admin': return 'Администратор';
                    case 'support-lead': return 'Support Lead';
                    case 'leads-helper': return 'Lead\'s Helper';
                    case 'support': return 'Support';
                    case 'support-assistant': return 'Support Assistant';
                    default: return role;
                }
            }
            
            // Открытие редактора методички
            function openEditor(postId, categoryId) {
                // Проверяем права доступа
                if (appData.currentUser.role === 'support' || appData.currentUser.role === 'support-assistant') {
                    showNotification('У вас нет прав для редактирования методички', true);
                    return;
                }
                
                let post = null;
                let category = null;
                
                if (postId) {
                    category = appData.manualData.categories.find(c => c.id === categoryId);
                    if (category) {
                        post = category.posts.find(p => p.id === postId);
                    }
                }
                
                // Заполняем данные
                document.getElementById('editorTitle').value = post ? post.title : '';
                document.getElementById('editorContent').innerHTML = post ? post.content : '';
                
                // Сохраняем данные о редактируемом посте
                document.getElementById('editorContent').dataset.postId = postId || '';
                document.getElementById('editorContent').dataset.categoryId = categoryId;
                
                // Показываем редактор
                editorModal.style.display = 'flex';
            }
            
            // Закрытие редактора методички
            document.querySelector('.close-editor').addEventListener('click', function() {
                editorModal.style.display = 'none';
            });
            
            document.querySelector('.cancel-btn').addEventListener('click', function() {
                editorModal.style.display = 'none';
            });
            
            // Сохранение материала методички
            document.querySelector('.save-btn').addEventListener('click', function() {
                const title = document.getElementById('editorTitle').value;
                const content = document.getElementById('editorContent').innerHTML;
                const postId = document.getElementById('editorContent').dataset.postId;
                const categoryId = parseInt(document.getElementById('editorContent').dataset.categoryId);
                
                if (!title || !content) {
                    showNotification('Заполните название и содержание материала', true);
                    return;
                }
                
                const category = appData.manualData.categories.find(c => c.id === categoryId);
                if (!category) {
                    showNotification('Ошибка: категория не найдена', true);
                    return;
                }
                
                if (postId) {
                    // Редактирование существующего поста
                    const post = category.posts.find(p => p.id === parseInt(postId));
                    if (post) {
                        post.title = title;
                        post.content = content;
                    }
                } else {
                    // Создание нового поста
                    const newId = category.posts.length > 0 ? 
                        Math.max(...category.posts.map(p => p.id)) + 1 : 1;
                    
                    category.posts.push({
                        id: newId,
                        title: title,
                        content: content,
                        date: new Date().toLocaleDateString('ru-RU')
                    });
                }
                
                // Обновляем интерфейс и закрываем редактор
                initManualContent();
                editorModal.style.display = 'none';
                saveData();
                showNotification('Материал успешно сохранен');
            });
            
            // Обработчики инструментов редактора
            document.querySelectorAll('.tool-btn[data-command]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const command = this.dataset.command;
                    
                    if (command === 'insertImage') {
                        const url = prompt('Введите URL изображения:', 'https://');
                        if (url) {
                            document.execCommand('insertHTML', false, `<img src="${url}" style="max-width: 100%;">`);
                        }
                    } else if (command === 'insertGif') {
                        const url = prompt('Введите URL GIF:', 'https://');
                        if (url) {
                            document.execCommand('insertHTML', false, `<img src="${url}" style="max-width: 100%;">`);
                        }
                    } else if (command === 'insertLink') {
                        const url = prompt('Введите URL ссылки:', 'https://');
                        if (url) {
                            const text = prompt('Введите текст ссылки:', 'Ссылка');
                            document.execCommand('insertHTML', false, `<a href="${url}" target="_blank">${text || url}</a>`);
                        }
                    } else if (command === 'insertTable') {
                        const rows = prompt('Количество строк:', '3');
                        const cols = prompt('Количество столбцов:', '3');
                        
                        if (rows && cols) {
                            let table = '<table border="1" style="width: 100%; border-collapse: collapse; margin: 10px 0;">';
                            for (let i = 0; i < parseInt(rows); i++) {
                                table += '<tr>';
                                for (let j = 0; j < parseInt(cols); j++) {
                                    table += `<td style="padding: 5px; border: 1px solid #444;">Ячейка ${i+1}-${j+1}</td>`;
                                }
                                table += '</tr>';
                            }
                            table += '</table>';
                            document.execCommand('insertHTML', false, table);
                        }
                    } else if (command === 'insertList') {
                        const type = confirm('Нумерованный список? (OK - да, Отмена - маркированный)');
                        document.execCommand(type ? 'insertOrderedList' : 'insertUnorderedList');
                    } else {
                        document.execCommand(command, false, null);
                    }
                    
                    document.getElementById('editorContent').focus();
                });
            });
            
            document.getElementById('fontSize').addEventListener('change', function() {
                document.execCommand('fontSize', false, this.value);
                document.getElementById('editorContent').focus();
            });
            
            document.getElementById('textColor').addEventListener('change', function() {
                document.execCommand('foreColor', false, this.value);
                document.getElementById('editorContent').focus();
            });
            
            // Добавление категории
            document.getElementById('addCategoryBtn').addEventListener('click', function() {
                // Проверяем права доступа
                if (appData.currentUser.role === 'support' || appData.currentUser.role === 'support-assistant') {
                    showNotification('У вас нет прав для добавления категорий', true);
                    return;
                }
                
                const name = prompt('Введите название новой категории:');
                if (name) {
                    const newId = appData.manualData.categories.length > 0 ? 
                        Math.max(...appData.manualData.categories.map(c => c.id)) + 1 : 1;
                    
                    appData.manualData.categories.push({
                        id: newId,
                        name: name,
                        posts: []
                    });
                    
                    initManualContent();
                    saveData();
                    showNotification('Категория успешно добавлена');
                }
            });
            
            // Открытие модального окна добавления участника
            document.getElementById('addMemberBtn').addEventListener('click', function() {
                // Проверяем права доступа
                if (appData.currentUser.role === 'support' || appData.currentUser.role === 'support-assistant') {
                    showNotification('У вас нет прав для добавления участников', true);
                    return;
                }
                
                // Заполняем список пользователей
                const select = document.getElementById('memberUser');
                select.innerHTML = '<option value="">Выберите пользователя</option>';
                
                // Получаем список пользователей, которые еще не добавлены в таблицу
                const existingMembers = appData.activationData.map(m => m.name);
                const availableUsers = appData.users
                    .filter(u => !existingMembers.includes(u.username))
                    .filter(u => u.username !== appData.currentUser.username);
                
                if (availableUsers.length === 0) {
                    showNotification('Нет доступных пользователей для добавления', true);
                    return;
                }
                
                availableUsers.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.username;
                    option.textContent = user.username;
                    select.appendChild(option);
                });
                
                // Показываем модальное окно
                addMemberModal.style.display = 'flex';
            });
            
            // Закрытие модального окна добавления участника
            closeAddMemberModal.addEventListener('click', function() {
                addMemberModal.style.display = 'none';
            });
            
            cancelAddMember.addEventListener('click', function() {
                addMemberModal.style.display = 'none';
            });
            
            // Добавление участника
            document.getElementById('confirmAddMember').addEventListener('click', function() {
                const username = document.getElementById('memberUser').value;
                const position = document.getElementById('memberPosition').value;
                
                if (!username) {
                    showNotification('Выберите пользователя', true);
                    return;
                }
                
                const user = appData.users.find(u => u.username === username);
                if (!user) {
                    showNotification('Пользователь не найден', true);
                    return;
                }
                
                appData.activationData.push({
                    name: username,
                    position: position,
                    days: Array(30).fill("0")
                });
                
                initActivationTable();
                addMemberModal.style.display = 'none';
                saveData();
                showNotification('Участник успешно добавлен');
            });
            
            // Добавление пользователя
            document.getElementById('addUserBtn').addEventListener('click', function() {
                const username = document.getElementById('newUsername').value;
                const password = document.getElementById('newPassword').value;
                const role = document.getElementById('newUserRole').value;
                
                if (!username || !password) {
                    showNotification('Заполните имя пользователя и пароль', true);
                    return;
                }
                
                if (appData.users.some(u => u.username === username)) {
                    showNotification('Пользователь с таким именем уже существует', true);
                    return;
                }
                
                appData.users.push({
                    username: username,
                    password: password,
                    role: role
                });
                
                initUsersList();
                document.getElementById('newUsername').value = '';
                document.getElementById('newPassword').value = '';
                saveData();
                showNotification('Пользователь успешно добавлен');
            });
            
            // Сохранение данных
            function saveData() {
                // Сохраняем в localStorage для демонстрации
                localStorage.setItem('gravitycraftData', JSON.stringify({
                    activationData: appData.activationData,
                    manualData: appData.manualData,
                    users: appData.users
                }));
                
                // В реальном приложении здесь будет запрос к серверу
                console.log('Данные сохранены');
            }
            
            // Загрузка данных
            function loadData() {
                const savedData = localStorage.getItem('gravitycraftData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    appData.activationData = data.activationData || [];
                    appData.manualData = data.manualData || { categories: [] };
                    appData.users = data.users || [];
                }
            }
            
            // Инициализация данных
            loadData();
            
            // Имитация работы системы
            setInterval(saveData, 30000); // Автосохранение каждые 30 секунд
            
            // Показать начальное уведомление
            setTimeout(() => {
                showNotification('Система успешно загружена. Данные синхронизированы');
            }, 1000);
        });
    </script>
</body>
</html>